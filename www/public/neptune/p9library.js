function _convertFlatToNested(e,t,n){for(var r,a,o,c=[],i={},l=0,u=e.length;l<u;l++)a=(r=e[l])[t],o=r[n]||0,i[a]=i[a]||[],r.children=i[a],0!==o?(i[o]=i[o]||[],i[o].push(r)):c.push(r);return c}function _convertNestedToFlat(e){var n=[],r=function(e){$.each(e,function(e,t){t.children&&(r(t.children),delete t.children),n.push(t)})};return r(JSON.parse(JSON.stringify(e.children))),n}var ModelData=function(){var e={version:"5.0.0",lastChanged:"2018-12-07",authors:"Neptune Software, Max Schaufler"},l=function(e,t,n,r,a){var o=e;S(e)&&(o=e.source,t=e.keys,n=e.values,r=e.operators,a=e.fnCallback,e.fnCallback=null);var c=A(o,t,n,r),i=!1;return 0<c.length&&(i=c[0]),i&&"function"==typeof a&&a(i),i},o=function(e,t,n){var r=!1;switch(n){case"Contains":r=-1!=e.indexOf(t);break;case"NE":r=e!=t;break;case"GT":r=t<e;break;case"GE":r=t<=e;break;case"LT":r=e<t;break;case"LE":r=e<=t;break;case"BT":Array.isArray(t)&&2==t.length&&(r=e>=t[0]&&e<=t[1]);break;case"StartsWith":r=t.toString().length<=e.toString().length&&t.toString()==e.toString().substr(0,t.toString().length);break;case"EndsWith":r=t.toString().length<=e.toString().length&&t.toString()==e.toString().substr(e.toString().length-t.toString().length,t.toString().length);break;default:r=e==t}return r},r=function(e){return 0<e.search("/")},a=function(e){return e.split("/")},c=function(e){return e.join("/")},u=function(e,t){return r(t)?(pathArray=a(t),firstPart=pathArray.shift(),"object"==typeof e[firstPart]?u(e[firstPart],c(pathArray)):e[firstPart]):e[t]},f=function(e,t,n){r(t)?(pathArray=a(t),firstPart=pathArray.shift(),"object"==typeof e[firstPart]?f(e[firstPart],c(pathArray),n):e[firstPart]=n):e[t]=n},s=function(e,t,n,r){return function(t,n,r){if(Array.isArray(t)&&"object"==typeof n&&0<Object.keys(n).length){var a=!1;return Object.keys(n).forEach(function(e){a=a||0<ModelData5.Find(t,e,n[e],r).length}),a}if(Array.isArray(t))return a=!1,t.forEach(function(e){a=a||o(e,n,r)}),a;if("object"==typeof t&&"object"==typeof n&&0<Object.keys(n).length)return a=!0,Object.keys(n).forEach(function(e){a=a&&o(t[e],n[e],r)}),a;return o(t,n,r)}(u(e,t),n,r)},p=function(r,e,a,o){var c=!0;return e.forEach(function(e,t,n){c=c&&s(r,e,a[t],o[t])}),c},d=function(r,e,a,o){var c=!0;return e.forEach(function(e,t,n){c=c&&s(r,e,a[e],o[t])}),c},h=function(e){var t=e.getModel();return t&&void 0!==t.oData&&void 0===t.oData.length&&(t.oData=[]),t&&void 0===t.oData&&(t.oData=[]),t};function g(e){var t="array",n="control",r="model",a=[],o=null,c=null,i="";if(Array.isArray(e))i=t,a=e;else{if("function"!=typeof e.getMetadata)throw"ModelData: bad source / "+e;"sap.ui.model.json.JSONModel"==e.getMetadata()._sClassName?(i=r,c=e):(i=n,o=e)}return{getArray:function(){switch(i){case r:return c.getData();case n:return h(o).getData();case t:return a}throw"ModelData: bad type for source / "+this},updateData:function(e){switch(i){case r:c.setData(e);break;case n:o.getModel().setData(e)}}}}var S=function(e){var t=!1;return"object"==typeof e&&"function"!=typeof e.getMetadata&&void 0!==e.source&&(t=!0),t},v=function(e){return Array.isArray(e)||(e=void 0===e?[]:[e]),e},y=function(e,t){var n="EQ";Array.isArray(e)||(n=e,e=[]);for(var r=e.length;r<t;r++)e[r]=n;return e},A=function(e,t,n,r,a){var o=e;S(e)&&(o=e.source,t=e.keys,n=e.values,r=e.operators,a=e.fnCallback);var c=new g(o).getArray(),i=[];return Array.isArray(c)&&0!=c.length?(t=v(t),n=v(n),r=y(r,t.length),t.length!=n.length||t.length!=r.length||(i=0===t.length?c:c.filter(function(e){return p(e,t,n,r)}),"function"==typeof a&&a(i),c=null),i):i};return{Find:A,FindFirst:l,LookupValue:function(e,t,n,r,a,o){var c=e;S(e)&&(c=e.source,t=e.keys,n=e.values,r=e.lookupField,a=e.operators,o=e.fnCallback);var i=l(c,t,n,a,o);return i?u(i,r):n},FindDB:function(e,t,n,r,o){if(void 0!==AppSync.db){var c=h(e),i=[],a=[];"string"==typeof r?a[0]=r:a=r,AppSync.db.transaction(function(e){e.executeSql("SELECT * FROM "+t+" WHERE "+n,a,function(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n);for(var a in r)"false"===r[a]&&(r[a]=!1),"true"===r[a]&&(r[a]=!0);i.push(r)}c.setData(i),"function"==typeof o&&o()},null)},function(e){"0"!==e.code&&(console.log(e.message),o())})}else"function"==typeof o&&o()},Add:function(e,t){var n=e;S(e)&&(n=e.source,t=e.data);var r=new g(n),a=r.getArray();a.push(t),r.updateData(a)},AddArray:function(e,t){var n=e;S(e)&&(n=e.source,t=e.data);for(var r=new g(n),a=r.getArray(),o=0;o<t.length;o++)a.push(t[o]);r.updateData(a)},Update:function(e,t,n,r,a){var o=e;S(e)&&(o=e.source,t=e.keys,n=e.values,r=e.data,a=e.operators,callBack=e.fnCallback);var c=new g(o),i=c.getArray(),l=!1;if(t=v(t),n=v(n),a=y(a,t.length),t.length==n.length&&t.length==a.length){var u=[];if(0<t.length)for(var s=i.length;s--;)p(i[s],t,n,a)&&(i[s]=r,l=!0,u.push(i[s]));!0!==l&&i.push(r),c.updateData(i),"function"==typeof callBack&&callBack(u)}},UpdateArray:function(e,t,n,r){var a=e;S(e)&&(a=e.source,t=e.keys,n=e.data,r=e.operators,callBack=e.fnCallback);var o=new g(a),c=o.getArray(),l=!1;if(t=v(t),r=y(r,t.length),t.length==r.length){var u=[];n.forEach(function(e){if(l=!1,0<t.length)for(i=0;i<c.length;i++)d(c[i],t,e,r)&&(c[i]=e,l=!0,u.push(c[i]));!1===l&&c.push(e)}),o.updateData(c),"function"==typeof callBack&&callBack(u)}},UpdateField:function(e,t,n,r,a,o){var c=e;S(e)&&(c=e.source,t=e.keys,n=e.values,r=e.updateKeys,a=e.updateValues,o=e.operators,callBack=e.fnCallback);var i=new g(c),l=i.getArray();if(void 0!==r&&(t=v(t),n=v(n),r=v(r),a=v(a),o=y(o,t.length),t.length==n.length&&t.length==o.length&&r.length==a.length)){for(var u=[],s=l.length;s--;)p(l[s],t,n,o)&&(r.forEach(function(e,t,n){f(l[s],e,a[t])}),u.push(l[s]));i.updateData(l),"function"==typeof callBack&&callBack(u)}},Delete:function(e,t,n,r){var a=e;S(e)&&(a=e.source,t=e.keys,n=e.values,r=e.operators,callBack=e.fnCallback);var o=new g(a),c=o.getArray();if(Array.isArray(c)&&0!=c.length&&(t=v(t),n=v(n),r=y(r,t.length),t.length==n.length&&t.length==r.length)){var i=[];if(0===t.length)c=[];else for(var l=c.length;l--;)if(p(c[l],t,n,r)){var u=c.splice(l,1);i.push(u[0])}o.updateData(c),"function"==typeof callBack&&callBack(i)}},getModel:h,genID:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:7&t|8).toString(16)})},versioninfo:e,version:e.version}}(),AppStorage={deviceID:"",useFallback:!1,Startup:function(){AppStorage.deviceID=localStorage.getItem("AppCacheID"),AppStorage.deviceID||(AppStorage.deviceID=ModelData.genID(),localStorage.setItem("AppCacheID",AppStorage.deviceID))}},p9Database=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,p9Views=p9Database.open("p9View",1);p9Views.isOpen=!1;var p9Models=p9Database.open("p9Model",1);function _AppCache_GetCache(e,t,n,r,a,o,c){return"DB"!==n||AppStorage.useFallback?_AppCache_GetCache_LS(e,t,r,a,c):_AppCache_GetCache_DB(e,t,r,a,c)}function _AppCache_SetCache(e,t,n,r,a,o){return"DB"!=n||AppStorage.useFallback?_AppCache_SetCache_LS(e,t,r,o):_AppCache_SetCache_DB(e,t,r,o)}function _AppCache_GetCache_LS(id,model,online,event,encryption){return new Promise(function(resolve,reject){try{$.sap.require("jquery.sap.storage");var lStorage=$.sap.storage(jQuery.sap.storage.Type.local),modelJSON=lStorage.get(id);if(online&&!modelJSON&&eval(online)(),!modelJSON)return"function"==typeof eval(event)&&eval(event)(),resolve();if(encryption){if(0!==modelJSON.indexOf("[")&&0!==modelJSON.indexOf("{")){var decrypted=CryptoJS.AES.decrypt(modelJSON,AppStorage.deviceID);modelJSON=decrypted.toString(CryptoJS.enc.Utf8)}}else if("string"==typeof modelJSON&&0!==modelJSON.indexOf("[")&&0!==modelJSON.indexOf("{"))return resolve();if("string"==typeof modelJSON)var modelData=JSON.parse(modelJSON);else var modelData=modelJSON;model.setData(modelData),"function"==typeof eval(event)&&eval(event)(),resolve()}catch(e){reject(e)}})}function _AppCache_SetCache_LS(a,o,c,i){return new Promise(function(e,t){try{$.sap.require("jquery.sap.storage");var n=$.sap.storage(jQuery.sap.storage.Type.local);if(c)var r=JSON.stringify(c);else r=o.getJSON();if(i)r=CryptoJS.AES.encrypt(r,AppStorage.deviceID).toString();n.remove(a),n.put(a,r),e()}catch(e){t(e)}})}function _AppCache_GetCache_DB(id,model,online,event,encryption){!function(){var tries=0;function check(){p9Models.isOpen?p9GetModel(id).then(function(value){var modelJSON=value;if(encryption){if(0!==modelJSON.indexOf("[")&&0!==modelJSON.indexOf("{")){var decrypted=CryptoJS.AES.decrypt(modelJSON,AppStorage.deviceID);modelJSON=decrypted.toString(CryptoJS.enc.Utf8)}}else if("string"==typeof modelJSON&&0!==modelJSON.indexOf("[")&&0!==modelJSON.indexOf("{"))return;var modelData=JSON.parse(modelJSON);model.setData(modelData),"function"==typeof eval(event)&&eval(event)(),online&&!model.oData.length&&eval(online)()}):(tries++,tries<50&&setTimeout(check,50))}check()}()}function _AppCache_SetCache_DB(t,e,n,r){if(n)var a=JSON.stringify(n);else a=e.getJSON();if(r){var o=CryptoJS.AES.encrypt(a,AppStorage.deviceID);a=o.toString()}var c;c=0,function e(){p9Models.isOpen?p9SaveModel(t,a):++c<50?setTimeout(e,50):_AppCache_Cache_Fallback()}()}function p9SaveModel(t,e){var n=p9Models.result.transaction("model","readwrite").objectStore("model").put({key:t,value:e});n.onerror=function(e){console.log("IndexedDB Error (p9SaveModel) Key "+t+n.error)}}function p9GetModel(r){return new Promise(function(e,t){var n=p9Models.result.transaction("model","readonly").objectStore("model").get(r);n.onsuccess=function(){n.result?e(n.result.value):e("{}")},n.onerror=function(){e("{}")}})}function p9SaveView(t,e){var n=p9Views.result.transaction("view","readwrite").objectStore("view").put({key:t,value:e});n.onerror=function(e){console.log("IndexedDB Error (p9SaveView) Key "+t+n.error)}}function p9GetView(r){return new Promise(function(e,t){var n=p9Views.result.transaction("view","readonly").objectStore("view").get(r);n.onsuccess=function(){n.result?e(n.result.value):e("{}")},n.onerror=function(){e("{}")}})}p9Models.isOpen=!1,p9Views.onupgradeneeded=function(e){e.target.result.createObjectStore("view",{keyPath:"key"})},p9Models.onupgradeneeded=function(e){e.target.result.createObjectStore("model",{keyPath:"key"})},p9Views.onerror=function(e){console.log("IndexedDB could not be opened. Using localStorage as Fallback"),_AppCache_GetCache_DB=_AppCache_GetCache_LS,_AppCache_SetCache_DB=_AppCache_SetCache_LS,p9Database=null},p9Models.onerror=function(e){console.log("IndexedDB could not be opened. Using localStorage as Fallback"),_AppCache_GetCache_DB=_AppCache_GetCache_LS,_AppCache_SetCache_DB=_AppCache_SetCache_LS,p9Database=null},p9Views.onsuccess=function(e){p9Views.isOpen=!0},p9Models.onsuccess=function(e){p9Models.isOpen=!0},AppStorage.Startup(),function(t){"use strict";var n,r=t.Base64;if("undefined"!=typeof module&&module.exports)try{n=require("buffer").Buffer}catch(e){}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(a),c=String.fromCharCode,i=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?c(192|t>>>6)+c(128|63&t):c(224|t>>>12&15)+c(128|t>>>6&63)+c(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return c(240|t>>>18&7)+c(128|t>>>12&63)+c(128|t>>>6&63)+c(128|63&t)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(e){return e.replace(l,i)},s=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[a.charAt(n>>>18),a.charAt(n>>>12&63),2<=t?"=":a.charAt(n>>>6&63),1<=t?"=":a.charAt(63&n)].join("")},f=t.btoa?function(e){return t.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,s)},p=n?n.from&&n.from!==Uint8Array.from?function(e){return(e.constructor===n.constructor?e:n.from(e)).toString("base64")}:function(e){return(e.constructor===n.constructor?e:new n(e)).toString("base64")}:function(e){return f(u(e))},d=function(e,t){return t?p(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):p(String(e))},h=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),g=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return c(55296+(t>>>10))+c(56320+(1023&t));case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},S=function(e){return e.replace(h,g)},v=function(e){var t=e.length,n=t%4,r=(0<t?o[e.charAt(0)]<<18:0)|(1<t?o[e.charAt(1)]<<12:0)|(2<t?o[e.charAt(2)]<<6:0)|(3<t?o[e.charAt(3)]:0),a=[c(r>>>16),c(r>>>8&255),c(255&r)];return a.length-=[0,0,2,1][n],a.join("")},y=t.atob?function(e){return t.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,v)},A=n?n.from&&n.from!==Uint8Array.from?function(e){return(e.constructor===n.constructor?e:n.from(e,"base64")).toString()}:function(e){return(e.constructor===n.constructor?e:new n(e,"base64")).toString()}:function(e){return S(y(e))},e=function(e){return A(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(t.Base64={VERSION:"2.3.2",atob:y,btoa:f,fromBase64:e,toBase64:d,utob:u,encode:d,encodeURI:function(e){return d(e,!0)},btou:S,decode:e,noConflict:function(){var e=t.Base64;return t.Base64=r,e}},"function"==typeof Object.defineProperty){var b=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",b(function(){return e(this)})),Object.defineProperty(String.prototype,"toBase64",b(function(e){return d(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",b(function(){return d(this,!0)}))}}t.Meteor&&(Base64=t.Base64),"undefined"!=typeof module&&module.exports?module.exports.Base64=t.Base64:"function"==typeof define&&define.amd&&define([],function(){return t.Base64})}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),AppSync={sqlSplit:150,tableFields:{},dataQueue:[],processing:!1,enableLog:!1,initTable:function(a,e){var o=this;this.openDB();var t="CREATE TABLE IF NOT EXISTS "+a+" (",n="";for(i=0;i<e.length;i++)0===i?t+=e[i]+" VARCHAR PRIMARY KEY":t+=n+e[i]+" VARCHAR",n=",";t+=")";try{o.db.transaction(function(e){e.executeSql(t,[])})}catch(e){console.log("Error: Unable to create table "+e+".")}AppSync.tableFields[a]=e,o.db.transaction(function(e){e.executeSql('SELECT name, sql FROM sqlite_master WHERE type="table" AND name = ?',[a],function(e,t){var n=t.rows.item(0).sql.replace(/^[^\(]+\(([^\)]+)\)/g,"$1").split(","),r=[];for(i in n)"string"==typeof n[i]&&r.push(n[i].trim().split(" ")[0]);$.each(AppSync.tableFields[a],function(e,t){if(-1===r.indexOf(t)){var n="ALTER TABLE "+a+" ADD "+t+" VARCHAR;";try{o.db.transaction(function(e){e.executeSql(n,[]),console.log("Table: "+a+", added field: "+t)})}catch(e){console.log("Error: Unable to alter table "+e+".")}}})})})},openDB:function(){if(void 0===this.db)if(window.sqlitePlugin)try{this.db=window.sqlitePlugin.openDatabase({name:"p9Data",location:2})}catch(e){return void console.error("Error: Unable to open database "+e)}else if(window.openDatabase)try{this.db=window.openDatabase("p9Data","1.0","p9Data",62914560)}catch(e){return void console.error("Error: Unable to open database "+e)}else console.error("Error: Your browser do not support WebSQL")},log:function(e){AppSync.enableLog&&console.log(e)},error:function(e){console.error(e)},updateDB:function(e,t,n){this.dataQueue.push({name:t,data:e,callback:n}),this.processing||this._seqUpdate()},_seqUpdate:function(){if(this.dataQueue.length){this.processing=!0;var e=this.dataQueue.shift(),t=e.name,s=e.data,f=e.callback,p=AppSync.tableFields[t],d=this;console.log("Starting an insert. In queue: "+this.dataQueue.length),d.db.transaction(function(n){var r="INSERT OR REPLACE INTO "+t+" (",a="",o="",c=!1,l=0,u=0;r+=d._arrayToString(p,","),o=r+=") SELECT ",$.each(s,function(e,t){for(u===p.length&&(a="",c=!(u=0),++l===AppSync.sqlSplit?(d._executeSql(o,null,n),o=r,l=0,c=!1):o+=" UNION SELECT "),i=0;i<p.length;i++)o+=a+'"'+t[p[i]]+'"',a=",",u++}),c&&d._executeSql(o,null,n),console.log("Done with an insert. In queue: "+d.dataQueue.length),d.dataQueue.length?d._seqUpdate():d.processing=!1,f&&f()},function(e){console.error("Insert failed",e),d.processing=!1})}},_executeSql:function(t,n,e,r){var a=this;a.log("_executeSql: "+t+" with param "+n),r||(r=a._defaultCallBack),e?a._executeSqlBridge(e,t,n,r,a._errorHandler):a.db.transaction(function(e){a._executeSqlBridge(e,t,n,r,a._errorHandler)})},_errorHandler:function(e,t){AppSync.error("Error : "+t.message+" (Code "+t.code+") Transaction.sql = "+e.sql)},_executeSqlBridge:function(t,e,n,r,a){if(void 0!==this.db.dbPath){var o=[e].concat(n);t.executeSql(o,function(e){e.rows.item=function(e){return this[e]},r(t,e)},a)}else t.executeSql(e,n,r,a)},_defaultCallBack:function(e,t){},_arrayToString:function(e,t){for(var n="",r=0;r<e.length;r++)n+=e[r],r<e.length-1&&(n+=t);return n}};